---
title: Quick Start With Consensus

icon: "Atom"
---

Welcome to the Metis SDK! This guide will help you quickly launch a Metis dev localnet or join in a chain.

A consensus-included Metis node comprises two components:

1. metis-sdk node (acting as the execution layer)
2. malachitebft node (acting as the consensus layer)

## Pre-Built Binaries

[Archives of precompiled binaries](https://github.com/MetisProtocol/metis-sdk/releases/) of metis are available for macOS and Linux. They are static executables. Users of platforms not explicitly listed below should download one of these archives.

## Docker

Metis engine node docker images: https://github.com/MetisProtocol/metis-sdk/pkgs/container/hyperion

Metis malachitebft node docker images: https://github.com/MetisProtocol/metis-sdk/pkgs/container/malachitebft

Metis engine node docker images and malachitebft node docker images for both x86\_64 and ARM64 machines are published with every release of reth on GitHub Container Registry.

```Plain
docker pull ghcr.io/metisprotocol/meits
docker pull ghcr.io/metisprotocol/malachitebft
```

Or a specific version (e.g. v0.7.1) with:

```Plain
docker pull ghcr.io/metisprotocol/metis:v0.7.1
docker pull ghcr.io/metisprotocol/malachitebft:v0.7.1
```

## Build from Source

### Dependencies

First, install Rust using [rustup](https://rustup.rs/):

```Plain
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

With Rust installed, follow the [instructions](https://github.com/MetisProtocol/metis-sdk/blob/main/CONTRIBUTING.md) below to install dependencies relevant to your operating system:

### Build Metis

With Rust and the dependencies installed, clone the repository:

```Plain
git clone https://github.com/MetisProtocol/metis-sdk
cd metis-sdk
```

Then, install metis into your `PATH` via:

```Plain
make install
```

Or build with the max performance mode

```Plain
make PROFILE=maxperf install
```

Alternatively, you can build yourself with:

```Plain
cargo build --release
```

This will place the reth binary under `./target/release/metis`, and you can copy it to your directory of preference after that.

### Build malachitebft

With Rust and the dependencies installed, clone the repository:

```Plain
git clone https://github.com/MetisProtocol/malaketh-layered.git
cd malaketh-layered
```

Alternatively, you can build yourself with:

```Plain
cargo build --release
```

This will place the reth binary under `./target/release/malachitebft-eth-app`, and you can copy it to your directory of preference after that.

## Launch a Metis Localnet

A Metis localnet with consensus must include at least three complete Metis nodes (Metis-sdk node + malachitebft node).

Take a localnet with three nodes as an example.

Step 1: Start three Metis-sdk nodes.

Step 2: Start three malachitebft nodes.

### Run From Binary

#### Start metis-sdk node:

You can use the script:

```Plain
git clone https://github.com/MetisProtocol/metis-sdk
cd metis-sdk/example/test-local-chain/from_bin
bash metis_nodes.sh
```

Or you can start metis-sdk node by yourself:

```Solidity
nohup metis node \
    ${VERBOSITY} \
    -d \
    --datadir="${datadir}" \
    --chain="${GENESIS_PATH}" \
    --http \
    --http.port="${http_port}" \
    --http.addr=0.0.0.0 \
    --http.corsdomain=* \
    --http.api=all \
    --authrpc.addr=0.0.0.0 \
    --authrpc.port="${authrpc_port}" \
    --authrpc.jwtsecret="${JWT_SECRET}" \
    --metrics=0.0.0.0:"${metrics_port}" \
    --discovery.port="${p2p_port}" \
    --port="${p2p_port}" \
    --ipcpath="${ipc_path}" \
    >> "${log_file}" 2>&1 &
```

A `JWT_SECRET` example is:

```Solidity
167814d140ef5b51febc9b2aa29c08dba3b67e0a343352722d33d1570e9fbfa1
```

A `genesis.json` example is:

```Plain
git clone https://github.com/MetisProtocol/malaketh-layered.git
ls malaketh-layered/assets/genesis.json
```

#### Start malachitebft node

You can use the script:

```Plain
git clone https://github.com/MetisProtocol/malaketh-layered.git
cd malaketh-layered
cp -fr nodes_config_bin nodes
bash scripts/spawn.bash --nodes 3 --home nodes
```

Or you can start malachitebft node by yourself:

```Plain
cd malaketh-layered
cp -fr nodes_config_bin nodes
malachitebft-eth-app start --home nodes/0
malachitebft-eth-app start --home nodes/1
malachitebft-eth-app start --home nodes/2
```

Configuration items you may need to pay attention toï¼š(eg. nodes/0/config/config.toml)

```Solidity
engine_url = "http://localhost:8551" // metis-sdk engine url/port
eth_url = "http://localhost:8545" // metis-sdk eth url/port
block_interval = "1s" // Interval between block productions
[consensus.p2p]
listen_addr = "/ip4/0.0.0.0/tcp/27000" // malachitebft node self listen p2p url/port
persistent_peers = [ // other node p2p url/port in the same chain
    "/ip4/127.0.0.1/tcp/27001",
    "/ip4/127.0.0.1/tcp/27002",
]
```

### Run From Docker

You can use the script:

```Plain
git clone https://github.com/MetisProtocol/metis-sdk
cd metis-sdk/example/test-local-chain/from_docker
bash start_metis_localnet.sh
```

Or you can start yourself with the docker compose

`metis-sdk/example/test-local-chain/from_docker/compose.yaml`

`metis-sdk/example/test-local-chain/from_docker/compose-mala.yaml`

## Start a Metis-consensus node and join in a chain

Same as "Launch a Metis Localnet", but just start one metis-sdk node and one malachitebft node.

Start metis-sdk node:

```Solidity
nohup metis node \
    ${VERBOSITY} \
    -d \
    --datadir="${datadir}" \
    --chain="${GENESIS_PATH}" \
    --http \
    --http.port="${http_port}" \
    --http.addr=0.0.0.0 \
    --http.corsdomain=* \
    --http.api=all \
    --authrpc.addr=0.0.0.0 \
    --authrpc.port="${authrpc_port}" \
    --authrpc.jwtsecret="${JWT_SECRET}" \
    --metrics=0.0.0.0:"${metrics_port}" \
    --discovery.port="${p2p_port}" \
    --port="${p2p_port}" \
    --ipcpath="${ipc_path}" \
    >> "${log_file}" 2>&1 &
```

Start malachitebft node

```Solidity
cd malaketh-layered
cp -fr nodes_config_bin nodes
malachitebft-eth-app start --home nodes/0
```

**Attention:**

1. Should use the \`genesis.json\` file corresponding to the target chain you want to connect to.
2. In malachitebft node config. `persistent_peers` should be modified to the URL/port of the nodes in the chain to be connected.

